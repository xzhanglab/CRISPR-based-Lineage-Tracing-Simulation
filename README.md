# Lineage-Tracing-Simulation

Simulation of CRISPR-Cas9 Editing on Evolving Barcode and Accuracy of Lineage Tracing. The folder 'code' contains all the code for simulation. The folders `data/plots` contain the raw data and plots generated by our simulations.

This project is under collaboration with Dr. Yipeng Yang, Department of Mathematics and Statistics, University of Houston (yangy@uhcl.edu).

The related manuscript is under revision.

## File Description for the Simulation Code

### main.m
This file contains the command to specify the parameters used for simulations; running this file in MATLAB will initiate the simulations. All detailed explanations of each parameter can be found in the command line annotation.

### btree.m
This file/function contains the implementation of a binary tree, a function to manipulate a binary tree structure.

### findm.m
This file/function finds and counts the matches between two matrices, specifically counting the total matched nodes and the total matched splitting nodes.

### funbarNBJ.m
This file/function compares the similarity between cells in a binary tree structure, reconstructs the lineage tree based on similarity scores, and evaluates the alignment and matching of nodes within the tree.

### funbarNBJ2.m
**Functionality**: Similar to `funbarNBJ`, but it includes an enhanced or alternative approach to compute similarities and reconstruct the lineage tree with additional and modified steps in the process.
**Difference**: `funbarNBJ2` includes enhancements or modifications to the original `funbarNBJ` method, involving different similarity computation techniques and reconstruction steps.

### funbarNBJ2trbk.m
**Functionality**: An extension of `funbarNBJ2`, focusing on reconstructing the lineage tree and evaluating it with a specific emphasis on traceback steps and node matching.
**Difference**: Adds detailed traceback functionality and additional evaluations, focusing on internal nodes and their matches during the tree reconstruction.

### funbarNBJNF.m
**Functionality**: Similar to `funbarNBJ` but without certain features or enhancements present in `funbarNBJ2` or `funbarNBJ2trbk`.
**Difference**: A simplified or variant version of `funbarNBJ`, possibly without the features or modifications introduced in the subsequent versions.

### funbarnew.m
**Functionality**: This function performs similarity comparison between cells in a binary tree structure, reconstructs the lineage tree based on similarity scores, and evaluates the alignment and matching of nodes within the tree, including handling of collapsing columns and comparison among the leaves and nodes.
**Similarities**: Both `funbarnew` and `funbarNBJ` compare the similarity between cells in a binary tree structure, reconstruct the lineage tree, and evaluate node matching and alignment.
**Differences**: `funbarnew` includes additional steps for handling collapsing columns and provides more detailed evaluations among leaves and nodes, along with more complex reconstruction logic and detailed metrics for the lineage tree.

### funbarnewRMPNF.m
Similar to `funbarNBJNF` but uses the NBJ method.

### genN.m
This file/function assigns generation numbers to each cell in a sample based on their similarity scores and relative positions within a tree structure.

### genN_unsorted.m
**Functionality**: This file/function assigns generation numbers without sorting cells based on similarity to the root, using random sampling and considering live leaves.
**Differences**: Unlike `genN`, which may sort cells by similarity to the root, `genN_unsorted` skips this sorting step and focuses on a random sample of live cells.

### genN_unsorted2.m
**Functionality**: This file/function assigns generation numbers to cells without sorting based on similarity to the root, focusing on a random sample of live leaves with a different structure for `checklive`.
**Differences**: Similar to `genN_unsorted`, it skips sorting by similarity to the root and uses a different structure for checking live cells, which influences how the generation numbers are assigned.

### genchild.m
This function generates a child barcode from a parent barcode by simulating mutations, cuts, insertions, deletions, and substitutions within the specified range.

### trim.m
This function trims the leading and trailing zeros from a vector and returns the resulting vector.

### valcheck.m
This function checks the validity of cell numbers in each generation of a lineage tree by ensuring the total number of cells does not exceed the maximum possible number at the deepest level.

### vcomp5.m and vcomp_cons.m
Both functions compare the similarity between two vectors `s` and `t`, and return a similarity score (`y`) and an optional matching string (`ost`). `vcomp5` performs similarity comparisons between vectors using a simpler 5x5 scoring matrix without handling consecutive matches or mismatches, while `vcomp_cons` uses a more complex 4x4 scoring matrix with additional handling for consecutive matches and mismatch penalties.
